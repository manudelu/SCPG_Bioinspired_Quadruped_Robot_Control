Learning Algorithm
==========================================

Spiking Patterns:
--------------------------------

* Walk: 

|    |t1 |t2 |t3 |t4 |
|----|---|---|---|---|
| N1 | 1 | 0 | 0 | 0 |
| N2 | 0 | 0 | 1 | 0 |
| N3 | 0 | 0 | 0 | 1 |
| N3 | 0 | 1 | 0 | 0 |
   
* Trot:

|    |t1 |t2 |
|----|---|---|
| N1 | 1 | 0 | 
| N2 | 0 | 1 | 
| N3 | 1 | 0 |
| N3 | 0 | 1 | 

* Bound:

|    |t1 |t2 |
|----|---|---|
| N1 | 1 | 0 | 
| N2 | 1 | 0 | 
| N3 | 0 | 1 |
| N3 | 0 | 1 | 
 
* Diagonal Walk:

|    |t1 |t2 |t3 |t4 |
|----|---|---|---|---|
| N1 | 1 | 0 | 0 | 0 |
| N2 | 0 | 0 | 1 | 0 |
| N3 | 0 | 1 | 0 | 0 |
| N3 | 0 | 0 | 0 | 1 |

* Gallop: 

|    |t1 |t2 |t3 |t4 |
|----|---|---|---|---|
| N1 | 1 | 0 | 0 | 0 |
| N2 | 0 | 1 | 0 | 0 |
| N3 | 0 | 0 | 1 | 0 |
| N3 | 0 | 0 | 0 | 1 |

Each gait sequence (Walk, Trot, Bound, Diagonal Walk and Gallop) must be repeated more than once during the learning process, otherwise you'll get a network that cannot stably reproduce gait. So we set a number of repetitions: ```reps = 10```.

Remark: 

* N_i = Neurons
* t_i = Time Instances

![](images/Gaits.png)

 The Network Structure of the Central Pattern Generator
 -----------------------------------

The SCPG network is composed of four fully connected neurons that generate gait pattern with spikes. Each neuron corresponds to one leg and spikes to activate the servo motor of the corresponding leg that finally actuates the leg. A sequence of spikes generated by the SCPG network can drive the locomotion of the quadruped robot. Such a sequence determines the gait pattern that controls the speed and direction of locomotion. The CPG neurons are driven by input neurons called gait selection neurons. We use five gait selection neurons to enable five different gaits. When a gait pattern is desired, one gait selection neuron stimulates a subset of CPG neurons to fire in a particular sequence and enable a designed locomotion gait. All the CPG neurons are connected to gait selection neurons with excitatory synapses. To emulate the dynamics of each neuron, we use a discretized leaky integrate and fire (LIF) model with membrane potential (Vj) expressed as:

![](https://latex.codecogs.com/png.latex?%5Cbg_white%20Vj%5Bt&plus;1%5D%20%3D%20%5Cfrac%7BVj%5Bt%5D%7D%7B%5Calpha%7D%20&plus;%20%5Csum_%7Bi%7DW_i_jS_i%5Bt%5D) 

The leaking current is modelled with a decay factor α (α must be > 1 in order to be physically reasonable, we used ```α = 1.1```). When the membrane potential Vj exceeds the spiking threshold Vth, a spike is fired and the membrane potential is instantly reset to the resting potential, which is zero. A pre-synaptic spike, Si,  results in the increment of the membrane potential of the post-synaptic neurons. The synaptic weights (Wij) scale the inputs from the presynaptic neurons (i-th neuron) to the post-synaptic neuron (j-th neuron) as shown in the equation. Therefore, the membrane voltage increase caused by the pre-synaptic spike occurs in the immediate next cycle. 

With that said, the training problem is to program the weight matrices so that when a gait selection neuron fires, the desired sets of CPG neurons fire in the next few time steps to generate the gait pattern. We use a supervised weight update algorithm to program the synaptic weights in the network. To start, all the weights are initialized randomly. In the beginning, the obtained and the required spiking patterns are not identical. The algorithm tries to make the required and
obtained spiking patterns identical. If the obtained and required spike patterns of the SCPG are the same then the neuron is firing correctly, thus the weights need no further modification. The total number of erroneous firings at every time step is called error. This procedure of stochastic updates is repeated for every gait.

Convergence
-------------------

In this section, we analyze the capacity of the algorithm to store multiple gaits on a single CPG. Due to the stochasticity of the weight adaptation algorithm, not all simulation trials achieve convergence. Also, as the number of gaits increases, the percentage of correct convergences is expected to drop. Thus, we choose a different number of gaits to be programmed and run 100 iterations for each (```n_trials = 100```). Then we identify the number of instances of all gaits being correctly learnt to obtain the percentage of cases where the system convergences correctly. In this case we observed that a maximum of three gaits can be learnt with a high convergence
rate of (> 80%). The convergence rate steeply drops when four gaits are to be simultaneously learnt to (∼ 20%) and also with five gaits (1%). More than five unique gaits cannot be simultaneously learnt in the current algorithm.

Biblioagraphy
-----------------

* A. Lele, Y. Fang, J. Ting and A. Raychowdhury, "An End-to-End Spiking Neural Network Platform for Edge Robotics: From Event-Cameras to Central Pattern Generation," in IEEE Transactions on Cognitive and Developmental Systems, vol. 14, no. 3, pp. 1092-1103, Sept. 2022, doi: 10.1109/TCDS.2021.3097675.
* Baruzzi V, Lodi M, Storace M, Shilnikov A. Towards more biologically plausible central-pattern-generator models. Phys Rev E. 2021 Dec;104(6-1):064405. doi: 10.1103/PhysRevE.104.064405. PMID: 35030894.
